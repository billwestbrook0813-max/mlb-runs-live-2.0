<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Salami Slider — by The Juice Junkies</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Anton:wght@400&family=Oswald:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0a0a0a;--chrome:#bfc6cf;--chrome-hi:#e5ebf7;--text:#f3f5f8;--muted:#d0d5df}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:radial-gradient(1200px 700px at 20% -10%, #1b1b1f 0, transparent 60%),radial-gradient(1000px 600px at 120% 10%, #151519 0, transparent 60%),var(--bg);color:var(--text);font-family:"Anton","Oswald","Impact","Arial Black",system-ui,Segoe UI,Roboto,Helvetica,Arial}
    header{position:sticky;top:0;z-index:20;background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(0,0,0,.35)),linear-gradient(90deg, var(--chrome-hi), var(--chrome), #7f8791, var(--chrome), var(--chrome-hi));border-bottom:2px solid #5a6069;box-shadow:0 8px 30px rgba(0,0,0,.55) inset;display:flex;align-items:center;gap:14px;padding:.6rem 1rem}
    .brand img{height:58px;width:auto;display:block;filter: drop-shadow(0 6px 12px rgba(0,0,0,.5))}
    .headline{font-size:14px;color:#0f0f12;text-transform:uppercase;letter-spacing:1.5px;padding:.25rem .6rem;border-radius:999px;background:linear-gradient(180deg,#ffd34a,#ffb300);border:1px solid #b27800;margin-left:auto;box-shadow:0 3px 12px rgba(0,0,0,.35)}
    .wrap{max-width:1200px;margin:0 auto;padding:1rem;position:relative;z-index:2}
    .title{display:flex;flex-direction:column;align-items:center;gap:.3rem;margin:1rem 0 1.2rem;text-transform:uppercase}
    .title img{max-width:min(92%,900px);height:auto;filter: drop-shadow(0 10px 30px rgba(255,0,0,.25))}
    .tagline{font-size:14px;letter-spacing:2px;color:var(--muted)}
    .cards{display:grid;grid-template-columns:repeat(12,1fr);gap:14px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,.45)),radial-gradient(120% 160% at 20% -10%, rgba(255,255,255,.12), transparent 50%),#191b21;border:2px solid #3a3f49;border-radius:18px;padding:1rem;box-shadow:0 18px 50px rgba(0,0,0,.55)}
    .card .label{color:#ffd34a;text-transform:uppercase;letter-spacing:1px;font-size:12px}
    .big{font-size:clamp(72px,18vw,180px);line-height:1}
    .submeta{color:var(--muted);font-family:system-ui,Arial;font-weight:600;letter-spacing:.3px}
    .progress-outer{height:28px;border-radius:999px;border:2px solid #3a3f49;background:linear-gradient(180deg,#0f1116,#181b23);overflow:hidden;box-shadow:inset 0 6px 18px rgba(0,0,0,.5),0 8px 20px rgba(0,0,0,.35)}
    .progress-inner{height:100%;background:linear-gradient(90deg,#ffd34a,#ff6a3d,#ff2d2d);box-shadow:inset 0 6px 12px rgba(0,0,0,.25),0 0 20px rgba(255,45,45,.35),0 0 60px rgba(255,211,74,.22);transition:width .35s ease-out}
    .ticker{grid-column:1 / -1;height:46px;border-radius:10px;overflow:hidden;border:2px solid #3a3f49;background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(0,0,0,.55)),linear-gradient(90deg, #c00 0 40%, #111 40% 100%);display:flex;align-items:center}
    .ticker__track{display:inline-flex;gap:30px;white-space:nowrap;will-change:transform;padding:0 .75rem;animation:ticker-move 30s linear infinite;font-family:"Oswald","Anton","Impact",sans-serif;font-weight:700;letter-spacing:.3px}
    .ticker__track.noscroll{animation:none !important;transform:none !important}
    @keyframes ticker-move{from{transform:translateX(0)} to{transform:translateX(-50%)}}
    .item{display:inline-flex;align-items:center;gap:8px;color:#fff;text-shadow:0 2px 0 #000}
    .pill{font-size:12px;padding:2px 8px;border-radius:14px;background:#111;color:#ffd34a;border:1px solid #444}
    .span-7{grid-column:span 7}.span-5{grid-column:span 5}.span-12{grid-column:1 / -1}
    @media (max-width: 880px){ .span-7,.span-5{ grid-column:1 / -1 } }
  </style>
</head>
<body>
  <header>
    <div class="brand"><img src="juice-junkies-logo.png" alt="Juice Junkies Logo" /></div>
    <div class="headline">Cold Beer • Hot Takes • Huge Totals</div>
  </header>

  <main class="wrap">
    <div class="title">
      <img src="salami-slider-logo.png" alt="Salami Slider" />
      <div class="tagline">“Lock It In. Slide That Salami.”</div>
    </div>

    <section class="cards">
      <div class="card span-7">
        <div class="label">Total MLB Runs Today</div>
        <div class="big" id="total">—</div>
        <div class="submeta" style="margin-top:.6rem; display:flex; gap:10px; flex-wrap:wrap;">
          <div>Games: <b id="games">—</b></div><div>•</div>
          <div>Date (PT): <b id="date">—</b></div><div>•</div>
          <div>Last update: <span id="updated">—</span></div>
        </div>
      </div>

      <div class="card span-5">
        <div class="label">Projected Total (juice-adjusted)</div>
        <div style="display:flex; justify-content:space-between; align-items:flex-end">
          <div style="font-size:44px; font-weight:900" id="proj">—</div>
          <div class="submeta" style="text-align:right">
            <div>Band (±1σ): <b id="band">—</b></div>
            <div>Market lean: <b id="lean">—</b></div>
          </div>
        </div>

        <div class="submeta" style="margin:.6rem 0 .35rem">Actual vs Projected</div>
        <div class="progress-outer"><div class="progress-inner" id="bar" style="width:0%"></div></div>
        <div class="submeta" style="display:flex; justify-content:space-between; margin-top:.45rem;">
          <div>Actual: <b id="actual">0</b></div>
          <div>Projected: <b id="proj2">—</b> (<span id="pct">0%</span>)</div>
        </div>
      </div>

      <div class="ticker span-12" id="ticker">
        <div class="ticker__track" id="tickerTrack"></div>
      </div>

      <div class="card span-12">
        <div class="label">Projected Slate Finish (Actual + Expected Remaining)</div>
        <div style="font-size:42px; font-weight:900; margin-top:.25rem" id="projFinish">—</div>
        <div class="submeta" style="margin-top:.35rem">
          <span>Actual runs today: <b id="actualToday">—</b></span>
          <span style="margin:0 .5rem">•</span>
          <span>Expected remaining (non-finals): <b id="remainingExp">—</b></span>
        </div>
      </div>

      <div class="card span-12">
        <div class="label" style="margin-bottom:.4rem">Consensus Totals (Per Game)</div>
        <div id="oulist" class="submeta">—</div>
      </div>
    </section>
  </main>

  <script>
    const $ = (id)=>document.getElementById(id);
    const setText=(id,v)=>($(id).textContent=v);
    function fmtPT(d){ return new Intl.DateTimeFormat('en-US',{ timeZone:'America/Los_Angeles', hour:'2-digit', minute:'2-digit', second:'2-digit' }).format(d); }
    async function getTwoNumbers(){ const r = await fetch(`/api/two-numbers`); if(!r.ok) throw new Error('two'); return r.json(); }
    async function getProj(){ const r = await fetch(`/api/projected-runs`); if(!r.ok) throw new Error('proj'); return r.json(); }
    async function getBoard(){ const r = await fetch(`/api/scoreboard`); if(!r.ok) throw new Error('board'); return r.json(); }

    function fmtItem(it){ return `${it.away} ${it.as} — ${it.home} ${it.hs}  |  ${it.tag}`; }
    async function refreshTicker(){
      try{
        const j = await getBoard();
        const items = j.items || [];
        const track = $('tickerTrack');
        const ticker = $('ticker');
        if (!track || !ticker) return;
        track.innerHTML = '';
        for (let pass=0; pass<2; pass++){
          items.forEach(it => {
            const div = document.createElement('div');
            div.className = 'item'; div.textContent = fmtItem(it);
            const pill = document.createElement('span'); pill.className = 'pill'; pill.textContent = it.state;
            div.appendChild(pill); track.appendChild(div);
          });
        }
        if (track.scrollWidth <= ticker.clientWidth) { track.classList.add('noscroll'); } else { track.classList.remove('noscroll'); }
        if (!ticker._hoverBound){
          ticker.addEventListener('mouseenter', () => track.style.animationPlayState = 'paused');
          ticker.addEventListener('mouseleave', () => track.style.animationPlayState = 'running');
          ticker._hoverBound = true;
        }
      }catch(e){ console.error(e); }
    }

    async function refreshAll(){
      try{
        const t = await getTwoNumbers();
        const actual = t.totalRunsScored ?? 0;
        const finish = t.projectedSlateFinish ?? 0;

        setText('total', actual);
        setText('actual', actual);
        setText('date', t.datePT ?? '—');
        setText('updated', fmtPT(new Date()));

        setText('proj', (Number(finish)||0).toFixed(1));
        setText('proj2', (Number(finish)||0).toFixed(1));

        const pct = finish>0 ? Math.min(150,(actual/finish)*100) : 0;
        document.getElementById('bar').style.width = `${pct.toFixed(1)}%`;
        setText('pct', `${(actual&&finish)? pct.toFixed(0):0}%`);

        setText('projFinish', (Number(finish)||0).toFixed(2));
        setText('actualToday', Number(actual).toFixed(0));
        setText('remainingExp', Number(finish - actual).toFixed(2));
      }catch(e){ console.error(e); }
    }

    async function refreshConsensus(){
      try{
        const p = await getProj();
        $('oulist').textContent =
          (p.games||[]).map(g => {
            const adj = g.consensus_total_adj ?? g.consensus_total;
            const now = Number(g.current_runs||0).toFixed(0);
            const rem = Number(g.expected_remaining||0).toFixed(2);
            return `${g.away_team || g.away} @ ${g.home_team || g.home}: ${Number(adj).toFixed(2)} | now ${now} | exp rem ${rem} (${g.status})`;
          }).join(' · ');
      }catch(e){ console.error(e); }
    }

    refreshAll(); refreshTicker(); refreshConsensus();
    setInterval(refreshAll, 15000);
    setInterval(refreshTicker, 15000);
    setInterval(refreshConsensus, 600000);
  </script>
</body>
</html>
